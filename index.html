<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Render and Upload Images from API</title>
        <script src="https://cdn.jsdelivr.net/npm/pocketbase/dist/pocketbase.umd.js"></script>
        <style>body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; } h2 { color: #333; } #image-container { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; } #image-container img { width: 200px; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); } #upload-form { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; align-items: center; } #upload-form input[type="file"] { margin-bottom: 20px; } #upload-form button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; } #upload-form button:hover { background-color: #0056b3; }</style>
    </head>
    <body>
        <a href="https://buy.stripe.com/test_eVag1Q8RW07zdMI6oo"><button style="width: 60px;">Click me!</button></a>
        <section style="height: 400px; width: 100%; background-color: #5b9e77; display: flex; align-items: center; justify-content: center;">
            <div id="image-container" style="display: flex; grid-auto-flow: column;"></div>
        </section>
        <h2>Upload New Image</h2>
        <form id="upload-form">
            <input type="file" id="file-input" name="file" accept="image/*" required/>
            <button type="submit">Upload</button>
        </form>
        <script>
      document.addEventListener("DOMContentLoaded", () => {
        const apiUrl =
          "https://pocketbase.excede.com.au/api/collections/images/records";

        // Fetch and render existing images
        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            const imageContainer = document.getElementById("image-container");
            data.items.forEach((item) => {
              const img = document.createElement("img");
              img.src = `https://pocketbase.excede.com.au/api/files/${item.collectionId}/${item.id}/${item.field}`;
              img.alt = item.field;
              imageContainer.appendChild(img);
            });
          })
          .catch((error) => console.error("Error fetching data:", error));

        // Handle file upload
        const form = document.getElementById("upload-form");
        form.addEventListener("submit", async (event) => {
          event.preventDefault();

          const fileInput = document.getElementById("file-input");
          const file = fileInput.files[0];

          if (!file) {
            alert("Please select a file.");
            return;
          }

          const formData = new FormData();
          formData.append("file", file);

          try {
            const pb = new PocketBase("https://pocketbase.excede.com.au");
            const data = await pb.collection("images").create(formData);

            // Add the new image to the page
            const img = document.createElement("img");
            img.src = `https://pocketbase.excede.com.au/api/files/${data.collectionId}/${data.id}/${data.field}`;
            img.alt = data.field;
            document.getElementById("image-container").appendChild(img);

            alert("File uploaded successfully.");
          } catch (error) {
            console.error("Error uploading file:", error);
            alert("Failed to upload file.");
          }
        });
      });
    </script>
    </body>
</html>
